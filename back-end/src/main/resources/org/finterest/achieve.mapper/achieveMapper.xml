<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.multi.spring3.achieve.mapper.AchieveMapper">

    <!-- 공통 칼럼 정의 -->
    <sql id="AchieveColumns">
        lm.material_id AS material_id,
        lm.title AS title,
        lm.material_img AS material_img,
        lm.link AS link,
        lm.description AS description,
        lm.content AS content_summary,  -- content의 앞 10자에 '...' 추가
        lm.created_at AS createdAt,
        lm.updated_at AS updatedAt,
        c.category_name AS categoryName  -- 카테고리 이름을 가져옴
    </sql>

    <!-- 기본 쿼리 구조 -->
    <sql id="BaseQuery">
        FROM learning_materials lm
        JOIN categories c ON lm.category_id = c.category_id
    </sql>

    <!-- 모든 항목 조회 -->
    <select id="all" resultType="com.multi.spring3.achieve.domain.AchieveVO">
        SELECT
        <include refid="AchieveColumns" />
        <include refid="BaseQuery" />
    </select>

    <!-- 특정 ID로 조회 -->
    <select id="one" parameterType="int" resultType="com.multi.spring3.achieve.domain.AchieveVO">
        SELECT
        <include refid="AchieveColumns" />
        <include refid="BaseQuery" />
        WHERE lm.material_id = #{material_id}
    </select>

    <!-- 카테고리로 필터링 -->
    <select id="categoryFilter" parameterType="int" resultType="com.multi.spring3.achieve.domain.AchieveVO">
        SELECT
        <include refid="AchieveColumns" />
        <include refid="BaseQuery" />
        WHERE c.category_id = #{category_id}
    </select>
</mapper>
