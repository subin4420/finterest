<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="org.finterest.quiz.mapper.QuizSetDetailsMapper">

    <!-- 특정 퀴즈 세트의 문제 목록 조회 -->
    <select id="selectQuizSetDetails" resultMap="QuizSetDetailsMap" parameterType="int">
        SELECT
            qs.set_id,
            qs.set_name,
            c.category_name,  -- 카테고리 이름
            q.quiz_id,
            q.question,
            q.choice1,
            q.choice2,
            q.choice3,
            q.choice4,
            q.correct_choice,   -- 정답 선택지
            q.created_at,       -- 퀴즈 생성일
            q.updated_at        -- 퀴즈 수정일
        FROM
            quiz_sets qs
                JOIN
            categories c ON qs.category_id = c.category_id  -- 카테고리 조인
                JOIN
            quiz_set_questions qsq ON qs.set_id = qsq.set_id
                JOIN
            quizzes q ON q.quiz_id = qsq.quiz_id
        WHERE
            qs.set_id = #{setId}
        GROUP BY
            qs.set_id, q.quiz_id
    </select>

    <!-- 결과 맵핑 설정 -->
    <resultMap id="QuizSetDetailsMap" type="org.finterest.quiz.domain.QuizSetDetailsVO">
        <id column="set_id" property="setId"/>
        <result column="set_name" property="setName"/>
        <result column="category_name" property="categoryName"/>  <!-- 카테고리 이름 매핑 -->
        <collection property="questions" ofType="org.finterest.quiz.domain.QuizVO">
            <id column="quiz_id" property="quizId"/>
            <result column="question" property="question"/>
            <result column="choice1" property="choice1"/>
            <result column="choice2" property="choice2"/>
            <result column="choice3" property="choice3"/>
            <result column="choice4" property="choice4"/>
            <result column="correct_choice" property="correctChoice"/>  <!-- 정답 매핑 -->
            <result column="created_at" property="createdAt"/>          <!-- 생성일 매핑 -->
            <result column="updated_at" property="updatedAt"/>          <!-- 수정일 매핑 -->
        </collection>
    </resultMap>

</mapper>
